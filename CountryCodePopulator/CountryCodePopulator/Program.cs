using System.Net;
using System.Security.Cryptography;
using System.Text;
using System.Text.Json;
using Microsoft.VisualBasic.CompilerServices;
using MySql.Data.MySqlClient;

var euMainBuilder = new MySqlConnectionStringBuilder
{
    Server = "priv-01.modern-hosting.com",
    Port = 3306,
    Database = "s965_BlackoutEU",
    UserID = "u965_JCaQjHTfJU",
    Password = "^EF^2xWP@t+8^cSXqSsszGS7",
    MaximumPoolSize = 500
};

var devtestBuilder = new MySqlConnectionStringBuilder
{
    Server = "priv-01.modern-hosting.com",
    Port = 3306,
    Database = "s1547_BlackoutEU",
    UserID = "u1547_IqbJaUmqKF",
    Password = "KqExSQhpO.ld=XTVkjKnA35M",
    MaximumPoolSize = 500
};

var conn = new MySqlConnection(euMainBuilder.ConnectionString);
conn.Open();
var cmd = new MySqlCommand("SELECT `UB_Players`.SteamID, `Moderation_IPInfo`.`CountryCode` FROM `Moderation_IPInfo` INNER JOIN `Moderation_PlayerInfo` ON `Moderation_PlayerInfo`.`IP` = `Moderation_IPInfo`.`IP` INNER JOIN `UB_Players` ON `UB_Players`.`SteamID` = `Moderation_PlayerInfo`.`PlayerID`",
    conn);

var rdr = cmd.ExecuteReader();
List<(ulong, string)> codes = new();
while (rdr.Read())
{
    if (!ulong.TryParse(rdr[0].ToString(), out var id))
        continue;

    var code = rdr[1].ToString();
    codes.Add((id, code));
    Console.WriteLine($"ID: {id}, Code: {code}");
}
var updateString = "";
foreach (var code in codes)
{
    updateString += $"UPDATE `UB_Players` SET `CountryCode` = {code.Item2} WHERE `SteamID` = {code.Item1};";
}

conn.Close();

/*
var ids = new List<ulong> { 76561198426915329,76561198973553462,76561198258214077,76561198089538379,76561199124688137,76561198065075657,76561198883070621,76561198330237683,76561199030024188,76561198805072510,76561198093430197,76561198169419792,76561199137792397,76561198321269677,76561198162840626,76561198073008451,76561198066186076,76561199223218879,76561199224693428,76561198338673794,76561198087448006,76561198451946078,76561198294748641,76561198308609279,76561198160553349,76561198259213455,76561198183563310,76561198449331051,76561198268579555,76561199094430001,76561198828996507,76561198406243209,76561198296350969,76561199107403538,76561199081499041,76561198399448429,76561198232274992,76561199153801042,76561198979677937,76561199123872721,76561198133123751,76561198877510647,76561198072824023,76561199215937440,76561199117350030,76561198055301578,76561199119015920,76561198106468107,76561198120664240,76561198170201435,76561198289711036,76561198127350837,76561198081796346,76561198219295457,76561199203280895,76561198368806596,76561198230868720,76561198304072329,76561198977339333,76561198092181932,76561198126384086,76561198173196165,76561198012613837,76561199166268233,76561198179313877,76561198352990961,76561199187685998,76561198110156105,76561198930962593,76561199247347706,76561198977706944,76561198889370975,76561198195239627,76561198323574646,76561198947275775,76561198115495142,76561198963295412,76561198990960628,76561198267315698,76561198019222991,76561198812845609,76561198149079559,76561199111972240,76561198054904520,76561198089487877,76561197983293596,76561199003363968,76561198810766759,76561198881838370,76561198872407212,76561198112816207,76561198200395711,76561198330773240,76561198135017667,76561198842127787,76561198179018270,76561198282519210,76561199114467941,76561198079848291,76561198027420804,76561198146086712,76561198293326482,76561199089713092,76561199236127336,76561199176391900,76561197982601738,76561198816274296,76561198378890160,76561198119481114,76561198877382279,76561198053041579,76561198401376415,76561198982451485,76561199124395514,76561198110468901,76561198388765468,76561199258641124,76561198253554073,76561198246046862,76561198856893651,76561198878985553,76561198863820300,76561199225613810,76561198171944181,76561199179201692,76561198366430419,76561198117861136,76561198897222949,76561198369661891,76561199250309385,76561198149938975,76561199074015463,76561199030951685,76561198215680439,76561198988125821,76561199041350880,76561198132784530,76561198216651697,76561198143139130 };
var conn = new MySqlConnection(euMainBuilder.ConnectionString);
conn.Open();
foreach (var id in ids)
{
    Console.WriteLine($"Adding supremium card to {id}");
    var cmd = new MySqlCommand($"INSERT IGNORE INTO `UB_Players` ( `SteamID` , `SteamName` , `AvatarLink` , `CountryCode` , `MuteExpiry`, `MuteReason`, `Hotkeys` ) VALUES ({id}, 'Temp', 'Temp' , 'NA' , {DateTimeOffset.UtcNow.ToUnixTimeSeconds()} , ' ', '4,3,5,6,7' );", conn);
    cmd.ExecuteScalar();
    cmd = new($"INSERT INTO `UB_Players_Cards` (`SteamID`,`CardID`,`IsBought`,`IsUnlocked`) VALUES ({id}, 5, 1, 0);", conn);
    cmd.ExecuteScalar();
}
conn.Close();
*/